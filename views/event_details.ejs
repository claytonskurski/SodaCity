<main>
    <section class="event-details container">
        <!-- Event Title (using summary) -->
        <h1><%= event.summary %></h1>

        <!-- Hero Image -->
        <% if (event.images && event.images.length > 0) { %>
            <div class="hero-image" style="background-image: url('<%= event.images[0] %>'); height: 400px; background-size: cover; background-position: center;"></div>
        <% } else if (event.image) { %>
            <div class="hero-image" style="background-image: url('<%= event.image %>'); height: 400px; background-size: cover; background-position: center;"></div>
        <% } %>

        <!-- Event Details -->
        <div class="event-info">
            <h2>Event Details</h2>
            <p><strong>Date:</strong> <%= new Date(event.dtstart).toLocaleDateString() %></p>
            <p><strong>Time:</strong> <%= new Date(event.dtstart).toLocaleTimeString() %> - <%= new Date(event.dtend).toLocaleTimeString() %></p>
            <p><strong>Location:</strong> <%= event.location %></p>

            <div class="description">
                <h2>Description</h2>
                <div class="description-content"><%= event.description %></div>
            </div>

            <% if (event.images && event.images.length > 1) { %>
                <div class="photo-gallery">
                    <h2>Photos</h2>
                    <div class="row">
                        <% event.images.slice(1).forEach(image => { %>
                            <div class="col-md-4">
                                <img src="<%= image %>" alt="Event Photo" class="img-fluid">
                            </div>
                        <% }); %>
                    </div>
                </div>
            <% } %>
        </div>

        <!-- RSVP Section (moved below event details) -->
        <div class="rsvp-section mt-5">
            <h2>RSVP to this Event</h2>
            <% if (event.rsvps.includes(user.username)) { %>
                <p>You have already RSVPed to this event.</p>
            <% } else { %>
                <button type="button" class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#rsvpModal">RSVP</button>
            <% } %>

            <div class="attendees mt-4">
                <h2>Attendees</h2>
                <% if (event.rsvps.length > 0) { %>
                    <ul>
                        <% event.rsvps.forEach(rsvp => { %>
                            <li><%= rsvp %></li>
                        <% }); %>
                    </ul>
                <% } else { %>
                    <p>No RSVPs yet. Be the first to RSVP!</p>
                <% } %>
            </div>
        </div>

        <!-- RSVP Modal -->
        <div class="modal fade" id="rsvpModal" tabindex="-1" aria-labelledby="rsvpModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="rsvpModalLabel">RSVP to <%= event.summary %></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="rsvpForm" action="/events/rsvp/<%= event.eventId %>" method="POST">
                            <div class="mb-3">
                                <label for="phoneNumber" class="form-label">Phone Number (required for event updates)</label>
                                <input type="tel" class="form-control" id="phoneNumber" name="phoneNumber" placeholder="e.g., 123-456-7890" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Confirm RSVP</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<style>
    .hero-image {
        width: 100%;
        margin-bottom: 20px;
    }
    .description-content {
        line-height: 1.6;
        font-size: 16px;
    }
    .photo-gallery img {
        margin-bottom: 15px;
        border-radius: 5px;
    }
    .rsvp-section {
        margin-top: 40px;
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>